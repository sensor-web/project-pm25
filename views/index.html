
<html>
   <head>
      {{> meta page_title=(__ 'index.title')}}
      {{> styles }}
      {{> head_scripts}}
      {{> map_config}}
      <link rel="stylesheet" href="/pm25/css/leaflet.css" />
   </head>
   <body>
      {{> header}}
      {{> fb}}
      {{#if show_map_search}}
      <div id="searchbar" class="row">
          <div class="input-field autocomplete">
            <input id="search-input" type="search" data-activates="search-dropdown" data-beloworigin="true" autocomplete="off" required>
            <label for="search-input"><i class="material-icons">search</i></label>
            <i class="material-icons">close</i>
          </div>
          <ul id="search-dropdown" class="dropdown-content ac-dropdown"></ul>
      </div>
      <div id="map" width="800" height="300"></div>
      {{/if}}
      {{#if slug}}
      <div class="card">
         <!-- Go to www.addthis.com/dashboard to customize your tools -->
         <div class="addthis_sharing_toolbox"></div>
         <h1><span id="latest-pm25" class="{{ average.status }}">{{ average.pm2_5 }}</span><span id="unit">&micro;g/m&sup3;</span></h1>
         <h2 id="pm25">{{{__ 'pm25.concentration.average'}}}<a class="question-mark" href="javascript:void(0);"><!--googleoff: index--><i class="material-icons">help_outline</i><!--googleon: index--></a></h2>
         <span id="week-range">{{__ 'week.range'}}<span class="{{week.minStatus}}">{{ week.min }}</span> ~ <span class="{{week.maxStatus}}">{{ week.max }}</span></span>
         <h3 id="location">@{{ display_name }}</h3>
         <h3 id="update">{{__ 'last.update'}} <time id="latest-time" data-livestamp="{{ average.create_time }}"></time></h3>
         <div id="latest-status">{{{ average.statusText }}}</div>
         <br>
         <div class="cta">
         <a id="subscribe-region" class="waves-effect waves-light btn-large modal-trigger" href="#region-subscribe-form"><!--googleoff: index--><i class="material-icons">add_alert</i><!--googleon: index-->{{__ 'pm25.subscribe.button'}}</a>
         </div>
      </div>

      <div class="card">
         <h2 class="medium">{{{__ 'nearby.stations.heading'}}}</h2>
         <ul id="nearby-stations">
         </ul>
            <p>
            {{__ 'get.sensor.help'}}<br>
            <div class="cta">
            <a id="get-sensor" class="waves-effect waves-light btn-large" href="/pm25/request/">{{__ 'get.sensor.button'}}</a>
            </div>
            </p>
      </div>

      <div class="card">
         <h2 class="medium">{{{__ 'relevant.regions.heading'}}}</h2>
         <ul id="state-rank">
            {{#if nearbyRegions.length}}
            {{#each nearbyRegions}}
               <li>
                  <a href="/pm25/region/{{ this.slug }}/">
                     <span class="concentration">
                        <span class="concentration-value {{ this.average.status }}">{{ this.average.pm2_5 }}</span><span id="unit">&micro;g/m&sup3;</span>
                     </span>
                     <span class="location">@{{ this.display_name }}</span>
                     <time class="update-time" data-livestamp="{{ this.average.create_time }}"></time>
                  </a>
               </li>
            {{/each}}
            {{else}}
              <li class="nodata">{{__ 'sorry.no.region'}}</li>
            {{/if}}
         </ul>
      </div>

      <div class="card">
         <h2 class="medium">{{{__ 'region.%s.top.heading' region_name}}}</h2>
         <ul id="state-rank">
            {{#if stateTop.length}}
            {{#each stateTop}}
               <li>
                  <a href="/pm25/station/{{ this.slug }}/">
                     <span class="concentration">
                        <span class="concentration-value {{ this.data.status }}">{{ this.data.pm2_5 }}</span><span id="unit">&micro;g/m&sup3;</span>
                     </span>
                     <span class="location">@{{ this.display_name }}</span>
                     <time class="update-time" data-livestamp="{{ this.data.create_time }}"></time>
                  </a>
               </li>
            {{/each}}
            {{else}}
              <li class="nodata">{{__ 'sorry.no.station'}}</li>
            {{/if}}
         </ul>
      </div>
      <div class="card">
         <h2 class="medium">{{{__ 'region.%s.top.heading' country}}}</h2>
         <ul id="country-rank">
            {{#if countryTop.length}}
            {{#each countryTop}}
               <li>
                  <a class="clearfix" href="/pm25/station/{{ this.slug }}/">
                     <span class="concentration">
                        <span class="concentration-value {{ this.data.status }}">{{ this.data.pm2_5 }}</span><span id="unit">&micro;g/m&sup3;</span>
                     </span>
                     <span class="location">@{{ this.slug }}</span>
                     <time class="update-time" data-livestamp="{{ this.data.create_time }}"></time>
                  </a>
               </li>
            {{/each}}
            {{else}}
              <li class="nodata">{{__ 'sorry.no.station'}}</li>
            {{/if}}
         </ul>
      </div>
      {{else}}
      <div class="card">
         <h2 class="medium">{{{__ 'sorry.no.region'}}}</h2>
            <p>
            {{__ 'get.sensor.help'}}<br>
            <a id="subscribe" class="waves-effect waves-light btn-large" href="/pm25/request/">{{__ 'get.sensor.button'}}</a>
            </p>
      </div>
      {{/if}}
      {{> pm25_modal }}
      {{> subscribe_modal form_id='region-subscribe-form' form_type='region' form_title=(__ 'subscribe.modal.heading.pm25') region_id=id survey=true}}
      {{> footer}}
      <script type="text/javascript">
         /* templates for javascript */
         const getStationListItem = function (station) {
             return `
                  <li>
                      <a href="/pm25/station/${station.slug}/">
                         <span class="concentration"><span class="concentration-value ${station.data.status}">${ station.data.pm2_5 }</span><span id="unit">&micro;g/m&sup3;</span></span>
                         <span class="location">@${ station.display_name } <span class="distance">({{__ 'distance'}} ${station.distance/1000} {{__ 'km'}})</span></span>
                         <time class="update-time" data-livestamp="${ station.data.create_time }"></time>
                      </a>
                   </li>`;
         };
         const getProgressListItem = function () {
             return '<li class="nodata"><div class="progress"><div class="indeterminate"></div></div></li>';
         };
         const getNoDataListItem = function () {
             return '<li class="nodata">{{__ "sorry.no.nearby.station"}}</li>';
         };
         const getErrorListItem = function () {
             return '<li class="nodata">{{{__ "sorry.no.gps"}}}</li>';
         };
      </script>
      {{> body_scripts}}
      <script src="/pm25/js/jquery.materialize-autocomplete.js" type="text/javascript"></script>
      <script src="/pm25/js/leaflet.js"></script>
      <script src="/pm25/js/station.js" type="text/javascript"></script>
      <script src="/pm25/js/index.js"></script>
      <!-- Go to www.addthis.com/dashboard to customize your tools -->
      <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57857d9efaca9ced"></script>
      <script>
        var PAGE_TITLE = '{{#if slug}}{{__ 'region.%s.title' display_name}}{{else if coords}}{{__ 'region.%s.title' region_name}}{{else}}{{__ 'region.%s.title' ''}}{{/if}}';
        $('title').text(PAGE_TITLE);
      </script>
   </body>
</html>

